<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  </head>
  <body>
    <h1>TensorFlow.js Example</h1>
    <p>Formula: \( y = 2x + 6 \)</p>

    <div>
      <button onclick="trainModel()">Entrenar Modelo</button>
      <input type="number" id="inputValue" value="4" />
      <button onclick="predict()">Predecir</button>
    </div>

    <div id="result"></div>

    <script>
      let model;
      let isModelReady = false;

      async function trainModel() {
        model = tf.sequential();
        model.add(tf.layers.dense({ units: 1, inputShape: [1] }));

        model.compile({ loss: "meanSquaredError", optimizer: "sgd" });

        const xs = tf.tensor2d([-6, -5, -4, -3, -2, -1, 0, 1, 2], [9, 1]);
        const ys = tf.tensor2d([-6, -4, -2, 0, 2, 4, 6, 8, 10], [9, 1]);

        await model.fit(xs, ys, { epochs: 350 });
        isModelReady = true;
        document.getElementById("result").innerText =
          "Modelo entrenado y listo para predecir";
      }

      async function predict() {
        if (!isModelReady) {
          document.getElementById("result").innerText =
            "El modelo no está entrenado aún";
          return;
        }

        const inputValue = parseFloat(
          document.getElementById("inputValue").value,
        );
        const inputTensor = tf.tensor2d([inputValue], [1, 1]);
        const prediction = model.predict(inputTensor);
        const result = await prediction.data();

        document.getElementById("result").innerText =
          `El resultado de predecir para ${inputValue} es: ${result[0]}`;

        inputTensor.dispose();
        prediction.dispose();
      }
    </script>
  </body>
</html>
